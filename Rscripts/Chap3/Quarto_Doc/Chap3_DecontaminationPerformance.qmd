---
title: "Chap3_DecontaminationPerformance"
author: "Linh Dang"
editor: visual
execute:
  warning: false
  message: false
format:
  html:
    code-fold: true
    toc: true
    toc-location: left
    toc-depth: 3
---

```{r message=FALSE}
## load libraries
library(phyloseq)
library(reshape2)
library(microViz)
library(microbiome)
library(vegan)
library(lme4)       # Linear Mixed Models (for repeated measures)
library(lmerTest)   # P-values for Mixed Models
library(emmeans)    # Pairwise comparisons
library(Wrench)
library(rstatix)
library(ggpubr)
library(tidyverse)
library(VennDiagram)
rm(list = ls())
```

# Part1: Do the decontamination approaches perform differently?

```{r echo=TRUE}
## Functions and variables
Kolors <- c("#9d547c","#56ca63","#a357d6","cornflowerblue","#419d2a","sandybrown","red3","peachpuff","cyan","paleturquoise3","mistyrose","mediumpurple","mediumseagreen","mediumorchid","moccasin","orange4","olivedrab","midnightblue","papayawhip","palevioletred4","brown1","greenyellow","orchid","navy","darkred","navajowhite1","mistyrose1","grey85","#525fd6","red2","#8cbe3a","#c944aa","indianred3","#5ba557","#9e66cb","#c1b735","#6d82ec","grey25","#e69728","#6654b0","lightsalmon3","lightcyan1","khaki1","seagreen1","plum1","lightsteelblue1","palevioletred3","mintcream","magenta3","#799330","#da7fdf","#3c782c","#e44586","blue4","#63c996","#dc3f53","#49cbc8","#cf3f29","#4fabda","#da6c2b","#598bd1","#b78c24","#8d4191","#a0b971","slategray1","sienna","plum1","lightyellow1","lightskyblue3","linen","limegreen","cornsilk1","mediumaquamarine","gray14","gold3","darkviolet","#b2386a","#479d71","#ae4341","#2ba198","#e07557","#5361a3","#dda353","#aa98df","#5b6114","#dc89bf","#327243","slateblue1","#e57b94","#277257","#9b62a0","#bbab59","#98495a","#526229","#d8827d","#857624","gray40","#9a4a22","#7c7d46","mediumslateblue","lemonchiffon1","#e3a073","#9e6b33", "gray74","slateblue1","rosybrown3", "lawngreen","gainsboro","dodgerblue3","deeppink3","firebrick3", "orchid2", "olivedrab1", "ivory3", "darkseagreen", "bisque2", "darkgoldenrod2", "blue2", "skyblue", "seashell2", "turquoise", "tan1", "seagreen2", "palevioletred3", "linen", "steelblue4","ghostwhite","dodgerblue1","deeppink1","firebrick1", "limegreen", "purple3", "khaki3", "snow3", "darkslategray","darkorchid","lavender", "magenta2", "palegreen", "salmon", "maroon", "cyan2","#671408","#FAEBD7","#7FFFD4","#F0FFFF","#A52A2A","burlywood","cadetblue","#7FFF00","chocolate","cornsilk","slateblue1","#FF7F50","red1","#008B8B","darkgoldenrod1","darkolivegreen","darkorange4","white","hotpink","honeydew1","goldenrod2","darkgreen","oldlace","darkslategray3","navajowhite3","orchid4","gray25","#F0924D")
## Wrench
WrenchWrapper <- function(PhyloObjct, grp, roundUp = F){
  cnt_table <- PhyloObjct %>% otu_table()
  group <- PhyloObjct %>% sample_data() %>% pull(grp)
  w <- wrench(cnt_table, condition = group)
  
  # deseq.obj <- DESeqDataSetFromMatrix(cnt_table %>% as.data.frame(), DataFrame(group), ~group)
  # DESeq2::sizeFactors(deseq.obj) <- w$nf
  # cnt_table_normalized <- DESeq2::counts(deseq.obj, normalized=TRUE)
  
  norm_factors <- w$nf
  norm_counts <- sweep(cnt_table, 2, norm_factors, FUN = '/')
  if(roundUp){norm_counts <- norm_counts %>% round()}
  if(!is.null(phy_tree(PhyloObjct, errorIfNULL = F))){
    return(phyloseq(otu_table(norm_counts, taxa_are_rows = T), tax_table(PhyloObjct %>% tax_table()), sample_data(PhyloObjct %>% sample_data()),
                    phy_tree(PhyloObjct)))
  } else{
    return(phyloseq(otu_table(norm_counts, taxa_are_rows = T), tax_table(PhyloObjct %>% tax_table()), sample_data(PhyloObjct %>% sample_data())))
  }
}
## append meta to have more info about mouse
append_AN_NR <- function(pseq, df_additional){
  df_meta <- meta(pseq)
  if(!"AN_NR" %in%  colnames(df_meta)){
    print("There must be AN_NR column!")
    return(NA)
  }
  ## check if info is already in the main data frame, warning if already exits
  col_names_fea <- setdiff(colnames(df_additional), "AN_NR")
  new_col_names_fea <- setdiff(col_names_fea, colnames(df_meta))
  if(length(new_col_names_fea)==0){
    warning("All new feature already exits, nothing to be added")
    return(pseq)
  }
  if(length(new_col_names_fea) < length(col_names_fea)){
    warning("partially info already there, add the rest!")
    df_additional <- df_additional %>% 
      select(c("AN_NR", new_col_names_fea))
  }
  
  df_meta_new <- df_meta %>% 
    rownames_to_column(var = "SampleName") %>% 
    left_join(., df_additional, by = "AN_NR") %>% 
    column_to_rownames(var = "SampleName")
  sample_data(pseq) <- df_meta_new
  return(pseq)
}


## alpha plot function with LMM with fixed and random variables
AlphaPlot_Violin_LMM <- function(df, SampleID, strata, val, metric = "Obsered species"){
  ## df: in pivot longer manner
  ## calc p value in manner of paired
  ## get y.position for ggplot
  y_pos <- t_test(formula = as.formula(sprintf("%s ~ %s", val, strata)), data = df) %>% add_xy_position() %>% pull(y.position)
  model <- lmer(as.formula(sprintf("%s ~ %s + (1|%s)", val, strata, SampleID)), data = df)
  emm <- emmeans(model, specs = as.formula(sprintf("pairwise ~ %s", strata)))
  contr <- contrast(emm, method = "pairwise")
  
  p_add <- contr %>% 
    as_tibble() %>%
    transmute(
      group1 = sub(" - .*", "", contrast),
      group2 = sub(".* - ", "", contrast),
      estimate,
      se = SE,
      statistic = t.ratio,
      df,
      p = p.value
      ##method = "emmeans model-based t-test"
    ) %>% 
    add_significance() %>% 
    mutate(y.position = y_pos)
  plt <- ggplot(df, aes(x = .data[[strata]], y = .data[[val]], fill = .data[[strata]])) +
    geom_violin() +
    #geom_boxplot(alpha = 0.6, outlier.shape = NA) +
    geom_boxplot(width=0.2) +
    geom_point(position = position_jitter(width = 0.1), alpha = 0.5) +
    # Connect lines for the same sample to show paired changes
    geom_line(aes(group = AN_NR), color = "gray", alpha = 0.5) +
    theme_minimal() +
    labs(
      title = "Comparison of Decontamination Methods",
      subtitle = sprintf("Alpha Diversity: %s", metric),
      y = metric
    ) +
    theme(legend.position = "none")
  plt <- plt + stat_pvalue_manual(p_add, label = "p.signif", inherit.aes = FALSE, tip.length = 0.01)
  return(plt)
}
## function dealing with df
extract_df <- function(lst_pseq, diversity = "obs"){
  ## diversity: obs, shannon, simpson, invsimpson
  ## extract meta
  df_meta <- meta(lst_pseq[[1]]) %>% 
    rownames_to_column(var = "SampleID") %>% 
    dplyr::select(SampleID, AN_NR)
  df_full <- df_meta
  for(nm in names(lst_pseq)){
    #print(nm)
    if(diversity == "obs"){
      div <- lst_pseq[[nm]] %>% 
        otu_table() %>% 
        specnumber(MARGIN = 2)
      df_tmp <- tibble(SampleID = names(div), !!nm := unname(div))
    }else{
      div <- lst_pseq[[nm]] %>% 
        otu_table() %>% 
        vegan::diversity(index = diversity, MARGIN = 2)
      df_tmp <- tibble(SampleID = names(div), !!nm := unname(div))
    }
    
    df_full <- df_full %>% 
      merge(., df_tmp, by = "SampleID")
    #print(df_full)
  }
  df_full_longer <- df_full %>% 
    select(-SampleID) %>% 
    pivot_longer(cols = -AN_NR, names_to = "Method", values_to = "Val")
  return(df_full_longer)
}
## beta plot with paired statistic
beta_plot_microViz <- function(pseq, taxa_rank = "genus", m_group = "sample_type", paired = NULL){
  unconstrained_aitchison_pca <- pseq %>% 
    tax_agg(taxa_rank) %>% 
    tax_transform("clr") %>% 
    ord_calc()
  pca_plot <- unconstrained_aitchison_pca %>% 
    ord_plot(
      plot_taxa = 1:4, colour = m_group, size = 1.25, tax_vec_length = 0.325, 
      tax_lab_style = tax_lab_style(max_angle = 90, aspect_ratio = 1), auto_caption = 8
    )
  customised_plot <- pca_plot +
    stat_ellipse(aes(linetype = .data[[m_group]], colour = .data[[m_group]]), linewidth = 0.3) + # linewidth not size, since ggplot 3.4.0
    scale_colour_brewer(palette = "Set1") +
    theme(legend.position = "bottom") +
    coord_fixed(ratio = 1, clip = "off") # makes rotated labels align correctly
  ## calculate p value
  aitchison_dists <- pseq %>%
    tax_transform("identity", rank = taxa_rank) %>%
    dist_calc("aitchison")
  tmp <- if(is.null(paired)){NULL} else{meta(aitchison_dists)[[paired]]}
  #print(tmp)
  aitchison_perm <- aitchison_dists %>%
    dist_permanova(
      seed = 210488, # for set.seed to ensure reproducibility of random process
      n_processes = 2, n_perms = 9999, # you should use at least 999!
      variables = m_group,
      strata = tmp
    )
  
  p_val <- perm_get(aitchison_perm) %>% as.data.frame() %>% pull(`Pr(>F)`) %>% .[1]
  p <- case_when(
    p_val > 0.05 ~ paste("p =", round(p_val,4), "n.s.", sep = " "),
    p_val < 0.05 &  p_val > 0.01 ~ paste("p =", round(p_val,4), "*", sep = " "),
    p_val <= 0.01 & p_val > 0.001  ~ paste("p =", round(p_val,4), "**", sep = " "),
    p_val <= 0.001 ~ paste("p =",round(p_val,4), "***", sep = " "),
  )
  # annotation
  annotations <- data.frame(
    xpos = c(-Inf),
    ypos =  c(Inf),
    annotateText = p,
    hjustvar = c(-0.2) ,
    vjustvar = c(1.5))
  res_plot <- customised_plot +
    geom_text(data=annotations,aes(x=xpos,y=ypos,hjust=hjustvar,vjust=vjustvar,
                                   label=annotateText), size = 4.5, inherit.aes = FALSE)
  return(res_plot)
}
## modified Venn diagram
my_Venn_Plot <- function(lst_pseq, N = 15, sorted_by = "sum"){
  top_A <- lst_pseq[[1]] %>% 
    tax_top(n = N, by = match.fun(sorted_by), rank = "species")
  top_B <- lst_pseq[[2]] %>% 
    tax_top(n= N, by = match.fun(sorted_by), rank = "species")
  A_B <- intersect(top_A, top_B)
  A_minus_B <- setdiff(top_A, top_B)
  B_minus_A <- setdiff(top_B, top_A)
  X <- list()
  X[[names(lst_pseq)[[1]]]] <- top_A
  X[[names(lst_pseq)[[2]]]] <- top_B
  plt_venn <-VennDiagram::venn.diagram(x = X,
                          filename = NULL,
                          fill = c("lightblue", "lightpink"),
                          alpha = 0.6,
                          cex = 1.2,
                          cat.cex = 1.2)
  grid.newpage()
  grid.draw(plt_venn)
  grid.text(
    paste(A_minus_B, collapse = "\n"),
    x = unit(0.15, "npc"),
    y = unit(0.5, "npc"),
    gp = gpar(col = "blue", fontsize = 9)
  )
  grid.text(
    paste(B_minus_A, collapse = "\n"),
    x = unit(0.75, "npc"),
    y = unit(0.5, "npc"),
    gp = gpar(col = "red", fontsize = 9)
  )
  grid.text(
    paste(A_B, collapse = "\n"),
    x = unit(0.5, "npc"),
    y = unit(0.5, "npc"),
    gp = gpar(col = "purple", fontsize = 9)
  )
}
## filter taxa according to their prevalence and get the top
get_most_prev <- function(pseq, prev_threshold = 0.5, N = 25){
  res <- pseq %>% 
    prevalence() %>% 
    tibble(taxa = names(.), value = .) %>% 
    filter(value >= prev_threshold) %>% 
    arrange(desc(value)) %>% 
    head(N)
  return(res)
}
```

```{r}
#| include: false
## Load data
#source("../../../add_code/Functions.R")
df_additionalInfo <- readxl::read_xlsx("../../../meta/Mice_meta.xlsx")
pseq_raw <- readRDS("../../../data/Chap3/pseq_Proj5_postFilter_v04.rds") %>% 
  ps_filter(ffpe.bulk == "bulk") %>% 
  ps_filter(true.control == "true") %>% 
  append_AN_NR(df_additional = df_additionalInfo) %>% 
  WrenchWrapper(grp = "Sex") 
pseq_restrictive <- readRDS("../../../data/Chap3/pseq_bulk_restrictive.rds") %>% 
  append_AN_NR(df_additionalInfo) %>% 
  WrenchWrapper(grp = "Sex")
pseq_decontam <- readRDS("../../../data/Chap3/pseq_bulk_decontam_p0.5.rds") %>% 
  append_AN_NR(df_additionalInfo) %>% 
  WrenchWrapper(grp = "Sex")
pseq_SCRuB <- readRDS("../../../data/Chap3/pseq_bulk_SCRuB.rds") %>% 
  append_AN_NR(df_additionalInfo) %>% 
  WrenchWrapper(grp = "Sex")
pseq_Nj <- readRDS("../../../data/Chap3/pseq_bulk_Fisher_v02.rds") %>% 
  append_AN_NR(df_additionalInfo) %>% 
  WrenchWrapper(grp = "Sex")
```

## Alpha Diversity

Plot various alpha diversity among decontamination approaches, with Linear Mixed Model as paired statistical test

```{r}
ls_pseq <- list(Raw = pseq_raw, Restrictive = pseq_restrictive, decontam = pseq_decontam, SCRuB = pseq_SCRuB, Nj = pseq_Nj)
```

### Observed Species

```{r}
## 
df <- extract_df(ls_pseq, diversity = "obs")
AlphaPlot_Violin_LMM(df, "AN_NR", "Method", "Val", "Observed Species")
```

### Shannon

```{r}
## shannon
df <- extract_df(ls_pseq, diversity = "shannon")
AlphaPlot_Violin_LMM(df, "AN_NR", "Method", "Val", "Shannon Index")
```

### Inversed Simpson

```{r}
## invsimpson
df <- extract_df(ls_pseq, diversity = "invsimpson")
AlphaPlot_Violin_LMM(df, "AN_NR", "Method", "Val", "invsimpson Index")
```

## Beta Diversity

Plot beta diversity of samples before and after decontaminated through various approaches

Raw vs Nejman

```{r}
pseq_raw <- pseq_raw %>% 
  ps_mutate(Decon_type = "Raw")
sample_names(pseq_raw) <- sprintf("%s_%s", "Raw", meta(pseq_raw)[["AN_NR"]])
pseq_Nj <- pseq_Nj %>% 
  ps_mutate(Decon_type = "Nj")
sample_names(pseq_Nj) <- sprintf("%s_%s", "Nj", meta(pseq_Nj)[["AN_NR"]])
pseq_RN <- merge_phyloseq(pseq_raw, pseq_Nj)
```

```{r}
beta_plot_microViz(pseq_RN, taxa_rank = "species", m_group = "Decon_type", paired = "AN_NR")
```

Raw vs. SCRuB

```{r}
pseq_SCRuB <- pseq_SCRuB %>% 
  ps_mutate(Decon_type = "SCRuB")
sample_names(pseq_SCRuB) <- sprintf("%s_%s", "SCRuB", meta(pseq_SCRuB)[["AN_NR"]])
pseq_RS <- merge_phyloseq(pseq_raw, pseq_SCRuB)
beta_plot_microViz(pseq_RS, taxa_rank = "species", m_group = "Decon_type", paired = "AN_NR")
```

Raw vs. restrictuve

```{r}
pseq_restrictive <- pseq_restrictive %>% 
  ps_mutate(Decon_type = "Restrictive")
sample_names(pseq_restrictive) <- sprintf("%s_%s", "Restrictive", meta(pseq_SCRuB)[["AN_NR"]])
pseq_RR <- merge_phyloseq(pseq_raw, pseq_restrictive)
beta_plot_microViz(pseq_RR, taxa_rank = "species", m_group = "Decon_type", paired = "AN_NR")
```

Raw vs. decontam

```{r}
pseq_decontam <- pseq_decontam %>% 
  ps_mutate(Decon_type = "decontam")
sample_names(pseq_decontam) <- sprintf("%s_%s", "decontam", meta(pseq_decontam)[["AN_NR"]])
pseq_RD <- merge_phyloseq(pseq_raw, pseq_decontam)
beta_plot_microViz(pseq_RD, taxa_rank = "species", m_group = "Decon_type", paired = "AN_NR")
```

All

```{r}
pseq_merge <- merge_phyloseq(pseq_raw, pseq_restrictive, pseq_decontam, pseq_SCRuB, pseq_Nj)
beta_plot_microViz(pseq_merge, taxa_rank = "species", m_group = "Decon_type", paired = "AN_NR")
```

### Pairwise

Adonis2 pairwise with constrains SampleID (via strata parameter)

```{r message=F}
library(pairwiseAdonis)
aitchison_dists <- pseq_merge %>%
  tax_transform("identity", rank = "genus") %>%
  dist_calc("aitchison") %>% 
  attr(which = "dist")
pw_adnois <- pairwise.adonis2(aitchison_dists ~ Decon_type, strata = "AN_NR", data = meta(pseq_merge))
for(nm in names(pw_adnois)){
  if(nm == "parent_call"){next}
  sprintf("%s : %f", nm, pw_adnois[[nm]][["Pr(>F)"]][[1]]) %>% print()
}
```

## Bacterial Composition

Investigate the most dominant bacterial composition before and after decontamination approaches.

```{r}
cols <- Kolors[1:5] ##distinct_palette(n = 5, add = NA)
names(cols) <- unique(samdat_tbl(pseq_merge)$Decon_type)
## comp plot
pseq_merge %>% 
    # sort all samples by similarity
  ps_seriate(rank = "species", tax_transform = "compositional", dist = "bray") %>% 
  # arrange the samples into Disease State groups
  ps_arrange(Decon_type) %>% 
   tax_transform("compositional", rank = "species") %>%
  comp_heatmap(
    taxa = tax_top(pseq_merge, 25, by = sum, rank = "species"),
    tax_anno = taxAnnotation(
      Prev. = anno_tax_prev(bar_width = 0.3, size = grid::unit(1, "cm"))
    ),
    sample_anno = sampleAnnotation(
      Decon_type = anno_sample("Decon_type"),
      col = list(State1 = cols), border = FALSE
      #Decon_type = anno_sample_cat("Decon_type", col = cols)
    ),
    sample_seriation = "Identity" # suppress sample reordering
  )
```

***Remarks***:

The bacterial profile in Raw phyloseq is different from the others.

```{r}
## taxa filter all taxa lelow 1%, plot comp heatmap plot

```

## Bacterial Barplot

```{r}
pseq_merge %>% 
  ps_mutate(Decon_type = factor(Decon_type, levels = c("Raw", "Restrictive", "decontam", "SCRuB", "Nj"))) %>% 
  comp_barplot(tax_level = "genus", n_taxa = 20, bar_outline_colour = NA, facet_by = "Decon_type")+
  coord_flip() +
  theme(axis.text.y = element_blank(),
        axis.ticks.y = element_blank())
```

## Inspect Species

Insect the overlap and in each approach, present its dominant species

### Sorted by Sum

```{r}
# top_raw <- pseq_raw %>% 
#   tax_top(n = 15, by = sum, rank = "species")
# top_Nj <- pseq_Nj %>% 
#   tax_top(n= 15, by = sum, rank = "species")
# Raw_Nj <- intersect(top_raw, top_Nj)
# Raw_minus_Nj <- setdiff(top_raw, top_Nj)
# Nj_minus_Raw <- setdiff(top_Nj, top_raw)
# plt_venn <-VennDiagram::venn.diagram(x = list(Raw = top_raw, NJ = top_Nj),
#                           filename = NULL,
#                           fill = c("lightblue", "lightpink"),
#                           alpha = 0.6,
#                           cex = 1.2,
#                           cat.cex = 1.2)
# grid.newpage()
# grid.draw(plt_venn)
# grid.text(
#   paste(Raw_minus_Nj, collapse = "\n"),
#   x = unit(0.15, "npc"),
#   y = unit(0.5, "npc"),
#   gp = gpar(col = "blue", fontsize = 9)
# )
# grid.text(
#   paste(Nj_minus_Raw, collapse = "\n"),
#   x = unit(0.75, "npc"),
#   y = unit(0.5, "npc"),
#   gp = gpar(col = "red", fontsize = 9)
# )
# grid.text(
#   paste(Raw_Nj, collapse = "\n"),
#   x = unit(0.5, "npc"),
#   y = unit(0.5, "npc"),
#   gp = gpar(col = "purple", fontsize = 9)
# )
```

Raw vs. Nj

```{r}
my_Venn_Plot(list(Raw = pseq_raw, Nj = pseq_Nj))
```

Raw vs. SCRuB

```{r}
my_Venn_Plot(list(Raw = pseq_raw, SCRuB = pseq_SCRuB))
```

Raw vs. restrictive

```{r}
my_Venn_Plot(list(Raw = pseq_raw, restrictive = pseq_restrictive))
```

Raw vs. decontam

```{r}
my_Venn_Plot(list(Raw = pseq_raw, decontam = pseq_decontam))
```

Nj vs. SCRuB

```{r}
my_Venn_Plot(list(Nj = pseq_Nj, SCRuB = pseq_SCRuB))
```

Nj vs. decontam

```{r}
my_Venn_Plot(list(Nj = pseq_Nj, decontam = pseq_decontam))
```

Venn diagram for all

```{r}
plt <- venn.diagram(x = list(Raw = tax_top(pseq_raw, n=15, by = sum, rank = "species"),
                             Restrictive = tax_top(pseq_restrictive, n=15, by = sum, rank = "species"),
                             decontam = tax_top(pseq_decontam, n=15, by = sum, rank = "species"),
                             SCRuB = tax_top(pseq_SCRuB, n=15, by = sum, rank = "species"),
                             Nj = tax_top(pseq_Nj, n=15, by = sum, rank = "species")),
                    filename = NULL,
                    fill = Kolors[1:5],
                          alpha = 0.6,
                          cex = 1.2,
                          cat.cex = 1.2)
grid.newpage()
grid.draw(plt)
```

### Sorted by Prev

Raw vs. Nj

```{r}
my_Venn_Plot(list(Raw = pseq_raw, Nj = pseq_Nj), N = 15, sorted_by = "prev")
```

Raw vs. SCRuB

```{r}
my_Venn_Plot(list(Raw = pseq_raw, SCRuB = pseq_SCRuB), N = 15, sorted_by = "prev")
```

Raw vs. decontam

```{r}
my_Venn_Plot(list(Raw = pseq_raw, decontam = pseq_decontam), N = 15, sorted_by = "prev")
```

Raw vs. restrictive

```{r}
my_Venn_Plot(list(Raw = pseq_raw, Restrictive = pseq_restrictive), N = 15, sorted_by = "prev")
```

SCRuB vs. Nj

```{r}
my_Venn_Plot(list(SCRuB = pseq_SCRuB, Nj = pseq_Nj), N = 15, sorted_by = "prev")
```

All

```{r}
func <- "prev"
plt <- venn.diagram(x = list(Raw = tax_top(pseq_raw, n=15, by = match.fun(func), rank = "species"),
                             Restrictive = tax_top(pseq_restrictive, n=15, by = match.fun(func), rank = "species"),
                             decontam = tax_top(pseq_decontam, n=15, by = match.fun(func), rank = "species"),
                             SCRuB = tax_top(pseq_SCRuB, n=15, by = match.fun(func), rank = "species"),
                             Nj = tax_top(pseq_Nj, n=15, by = match.fun(func), rank = "species")),
                    filename = NULL,
                    fill = Kolors[1:5],
                          alpha = 0.6,
                          cex = 1.2,
                          cat.cex = 1.2)
grid.newpage()
grid.draw(plt)
```

# Integrate serial NCT

Integrate info of serial NCT into overlap analyses.

```{r}
pseq_NCT <- readRDS("../../../data/Chap1/NCTs_v7_wrench.rds")
lst_NCT <- get_most_prev(pseq_NCT, 0.25, 1000)
```

```{r}
my_Venn_Plot(list(Nj = pseq_SCRuB, NCT = pseq_NCT), N = 15)
```

Note: not list taxa in NCT list. allow different size for two sets.
