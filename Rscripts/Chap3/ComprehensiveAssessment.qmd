---
title: "Comprehensive Assessment"
author: "Linh Dang"
format: html
editor: visual
---

```{r}
library(phyloseq)
library(microViz)
library(microbiome)
library(vegan)
library(Wrench)
library(tidyverse)
rm(list = ls())
source("../../add_code/Functions.R")
df_additionalInfo <- readxl::read_xlsx("../../meta/Mice_meta.xlsx")
pseq_raw <- readRDS("../../data/Chap3/pseq_Proj5_postFilter_v04.rds") %>% 
  ps_filter(ffpe.bulk == "bulk") %>% 
  ps_filter(true.control == "true") %>% 
  append_AN_NR(df_additional = df_additionalInfo) %>% 
  WrenchWrapper(grp = "Sex") 
pseq_restrictive <- readRDS("../../data/Chap3/pseq_bulk_restrictive.rds") %>% 
  append_AN_NR(df_additionalInfo) %>% 
  WrenchWrapper(grp = "Sex")
pseq_decontam <- readRDS("../../data/Chap3/pseq_bulk_decontam_p0.5.rds") %>% 
  append_AN_NR(df_additionalInfo) %>% 
  WrenchWrapper(grp = "Sex")
pseq_SCRuB <- readRDS("../../data/Chap3/pseq_bulk_SCRuB.rds") %>% 
  append_AN_NR(df_additionalInfo) %>% 
  WrenchWrapper(grp = "Sex")
pseq_Nj <- readRDS("../../data/Chap3/pseq_bulk_Fisher_v02.rds") %>% 
  append_AN_NR(df_additionalInfo) %>% 
  WrenchWrapper(grp = "Sex")
```

## Comprehensive Assessment of Decontamination Methods

Due to lacking of ground truth or mock community. Here are the alternative assess approaches we could use:

-   Assessment of batch effect removal

-   Divergence from Negative Controls

-   Biologically meaningful of Consensus taxa

-   Overlap with known true taxa / contaminants.

## 1. Assessment of batch effect removal

-   **Main idea**: A good decontamination method should reduce technical variation. In this case is the technician.

-   **Approach:** Perform Ordination (PCoA) and PERMANOVA (adonis2).

-   **Metric:** Check if the variance explained (R2) by "Sequencing Run" or "Extraction Batch" decreases after decontamination.

-   **Logic:** Real tumor microbiomes shouldn't cluster by which technician sequenced.

```{r}
#### 
dist_raw
```

## 2. Divergence from Negative Controls

## 3. Biologically meaningful of Consensus taxa

## 4. Overlap with known true taxa / contaminants
